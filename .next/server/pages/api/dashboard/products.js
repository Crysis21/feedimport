"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/dashboard/products";
exports.ids = ["pages/api/dashboard/products"];
exports.modules = {

/***/ "(api-node)/./lib/firebase.js":
/*!*************************!*\
  !*** ./lib/firebase.js ***!
  \*************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   auth: () => (/* binding */ auth),\n/* harmony export */   db: () => (/* binding */ db),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var firebase_app__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! firebase/app */ \"firebase/app\");\n/* harmony import */ var firebase_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! firebase/auth */ \"firebase/auth\");\n/* harmony import */ var firebase_firestore__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! firebase/firestore */ \"firebase/firestore\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([firebase_app__WEBPACK_IMPORTED_MODULE_0__, firebase_auth__WEBPACK_IMPORTED_MODULE_1__, firebase_firestore__WEBPACK_IMPORTED_MODULE_2__]);\n([firebase_app__WEBPACK_IMPORTED_MODULE_0__, firebase_auth__WEBPACK_IMPORTED_MODULE_1__, firebase_firestore__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\nconst firebaseConfig = {\n    apiKey: \"AIzaSyCPiNqBJ6bQ-PhQpSK-YCFIGDBikpcClPI\",\n    authDomain: \"feeder-fa563.firebaseapp.com\",\n    projectId: \"feeder-fa563\",\n    storageBucket: \"feeder-fa563.firebasestorage.app\",\n    messagingSenderId: \"189009193217\",\n    appId: \"1:189009193217:web:4f297cf644c8a9c14b1300\"\n};\nconst app = (0,firebase_app__WEBPACK_IMPORTED_MODULE_0__.initializeApp)(firebaseConfig);\nconst auth = (0,firebase_auth__WEBPACK_IMPORTED_MODULE_1__.getAuth)(app);\nconst db = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_2__.getFirestore)(app);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (app);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9maXJlYmFzZS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBNkM7QUFDTDtBQUNVO0FBRWxELE1BQU1HLGlCQUFpQjtJQUNyQkMsUUFBUUMseUNBQTRCO0lBQ3BDRyxZQUFZSCw4QkFBZ0M7SUFDNUNLLFdBQVdMLGNBQStCO0lBQzFDTyxlQUFlUCxrQ0FBbUM7SUFDbERTLG1CQUFtQlQsY0FBd0M7SUFDM0RXLE9BQU9YLDJDQUEyQjtBQUNwQztBQUVBLE1BQU1hLE1BQU1sQiwyREFBYUEsQ0FBQ0c7QUFDbkIsTUFBTWdCLE9BQU9sQixzREFBT0EsQ0FBQ2lCLEtBQUs7QUFDMUIsTUFBTUUsS0FBS2xCLGdFQUFZQSxDQUFDZ0IsS0FBSztBQUNwQyxpRUFBZUEsR0FBR0EsRUFBQyIsInNvdXJjZXMiOlsiL1VzZXJzL2NyaXN0aWFuL2Rldi9ob2xkb25lL2ZlZWRpbXBvcnQvbGliL2ZpcmViYXNlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGluaXRpYWxpemVBcHAgfSBmcm9tICdmaXJlYmFzZS9hcHAnO1xuaW1wb3J0IHsgZ2V0QXV0aCB9IGZyb20gJ2ZpcmViYXNlL2F1dGgnO1xuaW1wb3J0IHsgZ2V0RmlyZXN0b3JlIH0gZnJvbSAnZmlyZWJhc2UvZmlyZXN0b3JlJztcblxuY29uc3QgZmlyZWJhc2VDb25maWcgPSB7XG4gIGFwaUtleTogcHJvY2Vzcy5lbnYuRklSRUJBU0VfQVBJX0tFWSxcbiAgYXV0aERvbWFpbjogcHJvY2Vzcy5lbnYuRklSRUJBU0VfQVVUSF9ET01BSU4sXG4gIHByb2plY3RJZDogcHJvY2Vzcy5lbnYuRklSRUJBU0VfUFJPSkVDVF9JRCxcbiAgc3RvcmFnZUJ1Y2tldDogcHJvY2Vzcy5lbnYuRklSRUJBU0VfU1RPUkFHRV9CVUNLRVQsXG4gIG1lc3NhZ2luZ1NlbmRlcklkOiBwcm9jZXNzLmVudi5GSVJFQkFTRV9NRVNTQUdJTkdfU0VOREVSX0lELFxuICBhcHBJZDogcHJvY2Vzcy5lbnYuRklSRUJBU0VfQVBQX0lEXG59O1xuXG5jb25zdCBhcHAgPSBpbml0aWFsaXplQXBwKGZpcmViYXNlQ29uZmlnKTtcbmV4cG9ydCBjb25zdCBhdXRoID0gZ2V0QXV0aChhcHApO1xuZXhwb3J0IGNvbnN0IGRiID0gZ2V0RmlyZXN0b3JlKGFwcCk7XG5leHBvcnQgZGVmYXVsdCBhcHA7Il0sIm5hbWVzIjpbImluaXRpYWxpemVBcHAiLCJnZXRBdXRoIiwiZ2V0RmlyZXN0b3JlIiwiZmlyZWJhc2VDb25maWciLCJhcGlLZXkiLCJwcm9jZXNzIiwiZW52IiwiRklSRUJBU0VfQVBJX0tFWSIsImF1dGhEb21haW4iLCJGSVJFQkFTRV9BVVRIX0RPTUFJTiIsInByb2plY3RJZCIsIkZJUkVCQVNFX1BST0pFQ1RfSUQiLCJzdG9yYWdlQnVja2V0IiwiRklSRUJBU0VfU1RPUkFHRV9CVUNLRVQiLCJtZXNzYWdpbmdTZW5kZXJJZCIsIkZJUkVCQVNFX01FU1NBR0lOR19TRU5ERVJfSUQiLCJhcHBJZCIsIkZJUkVCQVNFX0FQUF9JRCIsImFwcCIsImF1dGgiLCJkYiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/firebase.js\n");

/***/ }),

/***/ "(api-node)/./lib/models.js":
/*!***********************!*\
  !*** ./lib/models.js ***!
  \***********************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   FeedModel: () => (/* binding */ FeedModel),\n/* harmony export */   ProductModel: () => (/* binding */ ProductModel),\n/* harmony export */   SyncJobModel: () => (/* binding */ SyncJobModel),\n/* harmony export */   WebhookModel: () => (/* binding */ WebhookModel)\n/* harmony export */ });\n/* harmony import */ var _firebase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./firebase.js */ \"(api-node)/./lib/firebase.js\");\n/* harmony import */ var firebase_firestore__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! firebase/firestore */ \"firebase/firestore\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_firebase_js__WEBPACK_IMPORTED_MODULE_0__, firebase_firestore__WEBPACK_IMPORTED_MODULE_1__]);\n([_firebase_js__WEBPACK_IMPORTED_MODULE_0__, firebase_firestore__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\nclass FeedModel {\n    static async create(userId, feedData) {\n        const docRef = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.addDoc)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.collection)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'feeds'), {\n            ...feedData,\n            userId,\n            createdAt: new Date(),\n            updatedAt: new Date(),\n            status: 'active',\n            lastSyncAt: null,\n            syncInterval: feedData.syncInterval || 3600000,\n            isPaused: false\n        });\n        return docRef.id;\n    }\n    static async getByUser(userId) {\n        const q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.query)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.collection)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'feeds'), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.where)('userId', '==', userId), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.orderBy)('createdAt', 'desc'));\n        const snapshot = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getDocs)(q);\n        return snapshot.docs.map((doc)=>({\n                id: doc.id,\n                ...doc.data()\n            }));\n    }\n    static async getById(feedId) {\n        const docRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'feeds', feedId);\n        const docSnap = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getDoc)(docRef);\n        return docSnap.exists() ? {\n            id: docSnap.id,\n            ...docSnap.data()\n        } : null;\n    }\n    static async update(feedId, updates) {\n        const docRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'feeds', feedId);\n        await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.updateDoc)(docRef, {\n            ...updates,\n            updatedAt: new Date()\n        });\n    }\n    static async delete(feedId) {\n        const docRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'feeds', feedId);\n        await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.deleteDoc)(docRef);\n    }\n}\nclass ProductModel {\n    static async createOrUpdate(feedId, productData) {\n        const productId = `${feedId}_${productData.sku || productData.id}`;\n        const docRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'products', productId);\n        const existingDoc = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getDoc)(docRef);\n        const existingData = existingDoc.exists() ? existingDoc.data() : null;\n        const productDoc = {\n            ...productData,\n            feedId,\n            lastUpdated: new Date(),\n            // Preserve existing category processing data\n            categoryProcessed: existingData?.categoryProcessed || false,\n            emagCategory: existingData?.emagCategory || null,\n            emagCategoryId: existingData?.emagCategoryId || null,\n            emagCategoryPath: existingData?.emagCategoryPath || null,\n            categoryUpdatedAt: existingData?.categoryUpdatedAt || null\n        };\n        if (!existingData) {\n            productDoc.createdAt = new Date();\n            console.log(`✨ Creating new product: ${productData.title}`);\n        } else {\n            console.log(`🔄 Updating existing product: ${productData.title} (categoryProcessed: ${existingData.categoryProcessed})`);\n        }\n        await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.setDoc)(docRef, productDoc, {\n            merge: true\n        });\n        return productId;\n    }\n    static async getByFeed(feedId, limitCount = 100, offset = 0) {\n        const q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.query)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.collection)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'products'), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.where)('feedId', '==', feedId), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.orderBy)('lastUpdated', 'desc'), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.limit)(limitCount));\n        const snapshot = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getDocs)(q);\n        return snapshot.docs.map((doc)=>({\n                id: doc.id,\n                ...doc.data()\n            }));\n    }\n    static async getUnprocessedProducts(limitCount = 100) {\n        console.log(`🔍 Fetching unprocessed products with limit: ${limitCount}`);\n        console.log(`🔍 Limit type: ${typeof limitCount}, value: ${limitCount}`);\n        // First get a count of all products and processed products for debugging\n        const allProductsQ = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.query)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.collection)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'products'));\n        const allSnapshot = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getDocs)(allProductsQ);\n        const totalProducts = allSnapshot.size;\n        const processedQ = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.query)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.collection)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'products'), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.where)('categoryProcessed', '==', true));\n        const processedSnapshot = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getDocs)(processedQ);\n        const processedCount = processedSnapshot.size;\n        console.log(`📊 Database stats: ${totalProducts} total products, ${processedCount} processed, ${totalProducts - processedCount} unprocessed`);\n        // Let's check what products have for categoryProcessed field\n        console.log(`🔍 Checking categoryProcessed field values...`);\n        let falseCount = 0;\n        let trueCount = 0;\n        let undefinedCount = 0;\n        let nullCount = 0;\n        allSnapshot.docs.forEach((doc)=>{\n            const data = doc.data();\n            if (data.categoryProcessed === false) falseCount++;\n            else if (data.categoryProcessed === true) trueCount++;\n            else if (data.categoryProcessed === undefined) undefinedCount++;\n            else if (data.categoryProcessed === null) nullCount++;\n        });\n        console.log(`📊 CategoryProcessed values: false=${falseCount}, true=${trueCount}, undefined=${undefinedCount}, null=${nullCount}`);\n        // Parse limit to ensure it's a number\n        const numericLimit = parseInt(limitCount) || 100;\n        console.log(`🔍 Using numeric limit: ${numericLimit}`);\n        const q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.query)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.collection)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'products'), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.where)('categoryProcessed', '==', false), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.limit)(numericLimit));\n        const snapshot = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getDocs)(q);\n        const products = snapshot.docs.map((doc)=>({\n                id: doc.id,\n                ...doc.data()\n            }));\n        console.log(`📦 Found ${products.length} unprocessed products to process (requested limit: ${limitCount}, numeric limit: ${numericLimit})`);\n        // Show first few products for debugging\n        if (products.length > 0) {\n            console.log(`🔍 First few unprocessed products:`);\n            products.slice(0, 3).forEach((product, index)=>{\n                console.log(`  ${index + 1}. \"${product.title}\" - categoryProcessed: ${product.categoryProcessed}`);\n            });\n        }\n        return products;\n    }\n    static async updateCategory(productId, categoryData) {\n        const docRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'products', productId);\n        await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.updateDoc)(docRef, {\n            emagCategory: categoryData.title,\n            emagCategoryId: categoryData.id,\n            emagCategoryPath: categoryData.path,\n            categoryProcessed: true,\n            categoryUpdatedAt: new Date()\n        });\n    }\n    static async getForFeedAPI(filters = {}) {\n        let q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.collection)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'products');\n        const conditions = [];\n        if (filters.feedId) {\n            conditions.push((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.where)('feedId', '==', filters.feedId));\n        }\n        if (filters.brand) {\n            conditions.push((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.where)('brand', '==', filters.brand));\n        }\n        if (filters.limit) {\n            conditions.push((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.limit)(filters.limit));\n        }\n        if (conditions.length > 0) {\n            q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.query)(q, ...conditions);\n        }\n        const snapshot = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getDocs)(q);\n        return snapshot.docs.map((doc)=>({\n                id: doc.id,\n                ...doc.data()\n            }));\n    }\n    static async getForDashboard(filters = {}) {\n        let q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.collection)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'products');\n        const conditions = [];\n        // Filter by user's feeds\n        if (filters.feedIds && filters.feedIds.length > 0) {\n            conditions.push((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.where)('feedId', 'in', filters.feedIds.slice(0, 10))); // Firestore limit\n        }\n        // Filter by specific feed\n        if (filters.feedId) {\n            conditions.push((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.where)('feedId', '==', filters.feedId));\n        }\n        // Filter by brand\n        if (filters.brand) {\n            conditions.push((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.where)('brand', '==', filters.brand));\n        }\n        // Filter by category processing status\n        if (filters.categoryProcessed !== null) {\n            conditions.push((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.where)('categoryProcessed', '==', filters.categoryProcessed));\n        }\n        // Add ordering and limit\n        conditions.push((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.orderBy)('lastUpdated', 'desc'));\n        conditions.push((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.limit)(filters.limit || 50));\n        if (conditions.length > 0) {\n            q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.query)(q, ...conditions);\n        }\n        const snapshot = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getDocs)(q);\n        let products = snapshot.docs.map((doc)=>({\n                id: doc.id,\n                ...doc.data()\n            }));\n        // Client-side filtering for search terms (since Firestore doesn't support full-text search)\n        if (filters.search) {\n            const searchLower = filters.search.toLowerCase();\n            products = products.filter((product)=>(product.title || '').toLowerCase().includes(searchLower) || (product.description || '').toLowerCase().includes(searchLower) || (product.brand || '').toLowerCase().includes(searchLower) || (product.originalCategories || []).some((cat)=>cat.toLowerCase().includes(searchLower)));\n        }\n        return {\n            products,\n            total: products.length\n        };\n    }\n    static async getBrandsByUser(feedIds) {\n        if (!feedIds || feedIds.length === 0) return [];\n        const q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.query)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.collection)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'products'), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.where)('feedId', 'in', feedIds.slice(0, 10)));\n        const snapshot = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getDocs)(q);\n        const brands = new Set();\n        snapshot.docs.forEach((doc)=>{\n            const product = doc.data();\n            if (product.brand && product.brand.trim()) {\n                brands.add(product.brand.trim());\n            }\n        });\n        return Array.from(brands).sort();\n    }\n    static async getProcessingStats(feedIds) {\n        if (!feedIds || feedIds.length === 0) {\n            return {\n                processed: 0,\n                unprocessed: 0,\n                total: 0\n            };\n        }\n        const q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.query)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.collection)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'products'), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.where)('feedId', 'in', feedIds.slice(0, 10)));\n        const snapshot = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getDocs)(q);\n        let processed = 0;\n        let unprocessed = 0;\n        snapshot.docs.forEach((doc)=>{\n            const product = doc.data();\n            if (product.categoryProcessed === true) {\n                processed++;\n            } else {\n                unprocessed++;\n            }\n        });\n        return {\n            processed,\n            unprocessed,\n            total: processed + unprocessed\n        };\n    }\n}\nclass SyncJobModel {\n    static async create(feedId, type = 'scheduled') {\n        const docRef = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.addDoc)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.collection)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'sync_jobs'), {\n            feedId,\n            type,\n            status: 'pending',\n            createdAt: new Date(),\n            startedAt: null,\n            completedAt: null,\n            error: null,\n            itemsProcessed: 0,\n            itemsTotal: 0\n        });\n        return docRef.id;\n    }\n    static async updateStatus(jobId, status, updates = {}) {\n        const updateData = {\n            status,\n            ...updates\n        };\n        if (status === 'running') {\n            updateData.startedAt = new Date();\n        } else if (status === 'completed' || status === 'failed') {\n            updateData.completedAt = new Date();\n        }\n        const docRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'sync_jobs', jobId);\n        await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.updateDoc)(docRef, updateData);\n    }\n    static async getActive() {\n        const q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.query)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.collection)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'sync_jobs'), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.where)('status', 'in', [\n            'pending',\n            'running'\n        ]), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.orderBy)('createdAt', 'asc'));\n        const snapshot = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getDocs)(q);\n        return snapshot.docs.map((doc)=>({\n                id: doc.id,\n                ...doc.data()\n            }));\n    }\n    static async getByFeed(feedId, limitCount = 20) {\n        const q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.query)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.collection)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'sync_jobs'), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.where)('feedId', '==', feedId), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.orderBy)('createdAt', 'desc'), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.limit)(limitCount));\n        const snapshot = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getDocs)(q);\n        return snapshot.docs.map((doc)=>({\n                id: doc.id,\n                ...doc.data()\n            }));\n    }\n}\nclass WebhookModel {\n    static async create(userId, webhookData) {\n        const docRef = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.addDoc)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.collection)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'webhooks'), {\n            ...webhookData,\n            userId,\n            createdAt: new Date(),\n            isActive: true,\n            lastTriggered: null\n        });\n        return docRef.id;\n    }\n    static async getByUser(userId) {\n        const q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.query)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.collection)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'webhooks'), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.where)('userId', '==', userId), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.where)('isActive', '==', true));\n        const snapshot = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getDocs)(q);\n        return snapshot.docs.map((doc)=>({\n                id: doc.id,\n                ...doc.data()\n            }));\n    }\n    static async trigger(webhookId, data) {\n        const docRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'webhooks', webhookId);\n        await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.updateDoc)(docRef, {\n            lastTriggered: new Date(),\n            lastTriggerData: data\n        });\n    }\n    static async getById(webhookId) {\n        const docRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'webhooks', webhookId);\n        const docSnap = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getDoc)(docRef);\n        return docSnap.exists() ? {\n            id: docSnap.id,\n            ...docSnap.data()\n        } : null;\n    }\n    static async update(webhookId, updates) {\n        const docRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)(_firebase_js__WEBPACK_IMPORTED_MODULE_0__.db, 'webhooks', webhookId);\n        await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.updateDoc)(docRef, {\n            ...updates,\n            updatedAt: new Date()\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RyxDQUFDN0IsQ0FBQUEsTUFBUTtnQkFDL0J3QixJQUFJeEIsSUFBSXdCLEVBQUU7Z0JBQ1YsR0FBR3hCLElBQUk4QixJQUFJLEVBQUU7WUFDZjtJQUNGO0lBRUEsYUFBYWdHLFFBQVFDLFNBQVMsRUFBRWpHLElBQUksRUFBRTtRQUNwQyxNQUFNZCxTQUFTaEIsdURBQUdBLENBQUNILDRDQUFFQSxFQUFFLFlBQVlrSTtRQUNuQyxNQUFNNUgsNkRBQVNBLENBQUNhLFFBQVE7WUFDdEI2RyxlQUFlLElBQUkzRztZQUNuQjhHLGlCQUFpQmxHO1FBQ25CO0lBQ0Y7SUFFQSxhQUFhQyxRQUFRZ0csU0FBUyxFQUFFO1FBQzlCLE1BQU0vRyxTQUFTaEIsdURBQUdBLENBQUNILDRDQUFFQSxFQUFFLFlBQVlrSTtRQUNuQyxNQUFNOUYsVUFBVSxNQUFNaEMsMERBQU1BLENBQUNlO1FBQzdCLE9BQU9pQixRQUFRQyxNQUFNLEtBQUs7WUFBRVYsSUFBSVMsUUFBUVQsRUFBRTtZQUFFLEdBQUdTLFFBQVFILElBQUksRUFBRTtRQUFDLElBQUk7SUFDcEU7SUFFQSxhQUFhSyxPQUFPNEYsU0FBUyxFQUFFM0YsT0FBTyxFQUFFO1FBQ3RDLE1BQU1wQixTQUFTaEIsdURBQUdBLENBQUNILDRDQUFFQSxFQUFFLFlBQVlrSTtRQUNuQyxNQUFNNUgsNkRBQVNBLENBQUNhLFFBQVE7WUFDdEIsR0FBR29CLE9BQU87WUFDVmpCLFdBQVcsSUFBSUQ7UUFDakI7SUFDRjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvY3Jpc3RpYW4vZGV2L2hvbGRvbmUvZmVlZGltcG9ydC9saWIvbW9kZWxzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRiIH0gZnJvbSAnLi9maXJlYmFzZS5qcyc7XG5pbXBvcnQgeyBcbiAgY29sbGVjdGlvbiwgXG4gIGFkZERvYywgXG4gIGRvYywgXG4gIGdldERvYywgXG4gIGdldERvY3MsIFxuICB1cGRhdGVEb2MsIFxuICBkZWxldGVEb2MsIFxuICBzZXREb2MsXG4gIHF1ZXJ5LCBcbiAgd2hlcmUsIFxuICBvcmRlckJ5LCBcbiAgbGltaXQgYXMgZmJMaW1pdCxcbiAgc3RhcnRBZnRlclxufSBmcm9tICdmaXJlYmFzZS9maXJlc3RvcmUnO1xuXG5leHBvcnQgY2xhc3MgRmVlZE1vZGVsIHtcbiAgc3RhdGljIGFzeW5jIGNyZWF0ZSh1c2VySWQsIGZlZWREYXRhKSB7XG4gICAgY29uc3QgZG9jUmVmID0gYXdhaXQgYWRkRG9jKGNvbGxlY3Rpb24oZGIsICdmZWVkcycpLCB7XG4gICAgICAuLi5mZWVkRGF0YSxcbiAgICAgIHVzZXJJZCxcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIHN0YXR1czogJ2FjdGl2ZScsXG4gICAgICBsYXN0U3luY0F0OiBudWxsLFxuICAgICAgc3luY0ludGVydmFsOiBmZWVkRGF0YS5zeW5jSW50ZXJ2YWwgfHwgMzYwMDAwMCwgLy8gMSBob3VyIGRlZmF1bHRcbiAgICAgIGlzUGF1c2VkOiBmYWxzZVxuICAgIH0pO1xuICAgIHJldHVybiBkb2NSZWYuaWQ7XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgZ2V0QnlVc2VyKHVzZXJJZCkge1xuICAgIGNvbnN0IHEgPSBxdWVyeShcbiAgICAgIGNvbGxlY3Rpb24oZGIsICdmZWVkcycpLFxuICAgICAgd2hlcmUoJ3VzZXJJZCcsICc9PScsIHVzZXJJZCksXG4gICAgICBvcmRlckJ5KCdjcmVhdGVkQXQnLCAnZGVzYycpXG4gICAgKTtcbiAgICBjb25zdCBzbmFwc2hvdCA9IGF3YWl0IGdldERvY3MocSk7XG4gICAgXG4gICAgcmV0dXJuIHNuYXBzaG90LmRvY3MubWFwKGRvYyA9PiAoe1xuICAgICAgaWQ6IGRvYy5pZCxcbiAgICAgIC4uLmRvYy5kYXRhKClcbiAgICB9KSk7XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgZ2V0QnlJZChmZWVkSWQpIHtcbiAgICBjb25zdCBkb2NSZWYgPSBkb2MoZGIsICdmZWVkcycsIGZlZWRJZCk7XG4gICAgY29uc3QgZG9jU25hcCA9IGF3YWl0IGdldERvYyhkb2NSZWYpO1xuICAgIHJldHVybiBkb2NTbmFwLmV4aXN0cygpID8geyBpZDogZG9jU25hcC5pZCwgLi4uZG9jU25hcC5kYXRhKCkgfSA6IG51bGw7XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgdXBkYXRlKGZlZWRJZCwgdXBkYXRlcykge1xuICAgIGNvbnN0IGRvY1JlZiA9IGRvYyhkYiwgJ2ZlZWRzJywgZmVlZElkKTtcbiAgICBhd2FpdCB1cGRhdGVEb2MoZG9jUmVmLCB7XG4gICAgICAuLi51cGRhdGVzLFxuICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpXG4gICAgfSk7XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgZGVsZXRlKGZlZWRJZCkge1xuICAgIGNvbnN0IGRvY1JlZiA9IGRvYyhkYiwgJ2ZlZWRzJywgZmVlZElkKTtcbiAgICBhd2FpdCBkZWxldGVEb2MoZG9jUmVmKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgUHJvZHVjdE1vZGVsIHtcbiAgc3RhdGljIGFzeW5jIGNyZWF0ZU9yVXBkYXRlKGZlZWRJZCwgcHJvZHVjdERhdGEpIHtcbiAgICBjb25zdCBwcm9kdWN0SWQgPSBgJHtmZWVkSWR9XyR7cHJvZHVjdERhdGEuc2t1IHx8IHByb2R1Y3REYXRhLmlkfWA7XG4gICAgXG4gICAgY29uc3QgZG9jUmVmID0gZG9jKGRiLCAncHJvZHVjdHMnLCBwcm9kdWN0SWQpO1xuICAgIGNvbnN0IGV4aXN0aW5nRG9jID0gYXdhaXQgZ2V0RG9jKGRvY1JlZik7XG4gICAgY29uc3QgZXhpc3RpbmdEYXRhID0gZXhpc3RpbmdEb2MuZXhpc3RzKCkgPyBleGlzdGluZ0RvYy5kYXRhKCkgOiBudWxsO1xuICAgIFxuICAgIGNvbnN0IHByb2R1Y3REb2MgPSB7XG4gICAgICAuLi5wcm9kdWN0RGF0YSxcbiAgICAgIGZlZWRJZCxcbiAgICAgIGxhc3RVcGRhdGVkOiBuZXcgRGF0ZSgpLFxuICAgICAgLy8gUHJlc2VydmUgZXhpc3RpbmcgY2F0ZWdvcnkgcHJvY2Vzc2luZyBkYXRhXG4gICAgICBjYXRlZ29yeVByb2Nlc3NlZDogZXhpc3RpbmdEYXRhPy5jYXRlZ29yeVByb2Nlc3NlZCB8fCBmYWxzZSxcbiAgICAgIGVtYWdDYXRlZ29yeTogZXhpc3RpbmdEYXRhPy5lbWFnQ2F0ZWdvcnkgfHwgbnVsbCxcbiAgICAgIGVtYWdDYXRlZ29yeUlkOiBleGlzdGluZ0RhdGE/LmVtYWdDYXRlZ29yeUlkIHx8IG51bGwsXG4gICAgICBlbWFnQ2F0ZWdvcnlQYXRoOiBleGlzdGluZ0RhdGE/LmVtYWdDYXRlZ29yeVBhdGggfHwgbnVsbCxcbiAgICAgIGNhdGVnb3J5VXBkYXRlZEF0OiBleGlzdGluZ0RhdGE/LmNhdGVnb3J5VXBkYXRlZEF0IHx8IG51bGxcbiAgICB9O1xuXG4gICAgaWYgKCFleGlzdGluZ0RhdGEpIHtcbiAgICAgIHByb2R1Y3REb2MuY3JlYXRlZEF0ID0gbmV3IERhdGUoKTtcbiAgICAgIGNvbnNvbGUubG9nKGDinKggQ3JlYXRpbmcgbmV3IHByb2R1Y3Q6ICR7cHJvZHVjdERhdGEudGl0bGV9YCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKGDwn5SEIFVwZGF0aW5nIGV4aXN0aW5nIHByb2R1Y3Q6ICR7cHJvZHVjdERhdGEudGl0bGV9IChjYXRlZ29yeVByb2Nlc3NlZDogJHtleGlzdGluZ0RhdGEuY2F0ZWdvcnlQcm9jZXNzZWR9KWApO1xuICAgIH1cblxuICAgIGF3YWl0IHNldERvYyhkb2NSZWYsIHByb2R1Y3REb2MsIHsgbWVyZ2U6IHRydWUgfSk7XG4gICAgcmV0dXJuIHByb2R1Y3RJZDtcbiAgfVxuXG4gIHN0YXRpYyBhc3luYyBnZXRCeUZlZWQoZmVlZElkLCBsaW1pdENvdW50ID0gMTAwLCBvZmZzZXQgPSAwKSB7XG4gICAgY29uc3QgcSA9IHF1ZXJ5KFxuICAgICAgY29sbGVjdGlvbihkYiwgJ3Byb2R1Y3RzJyksXG4gICAgICB3aGVyZSgnZmVlZElkJywgJz09JywgZmVlZElkKSxcbiAgICAgIG9yZGVyQnkoJ2xhc3RVcGRhdGVkJywgJ2Rlc2MnKSxcbiAgICAgIGZiTGltaXQobGltaXRDb3VudClcbiAgICApO1xuICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhxKTtcbiAgICBcbiAgICByZXR1cm4gc25hcHNob3QuZG9jcy5tYXAoZG9jID0+ICh7XG4gICAgICBpZDogZG9jLmlkLFxuICAgICAgLi4uZG9jLmRhdGEoKVxuICAgIH0pKTtcbiAgfVxuXG4gIHN0YXRpYyBhc3luYyBnZXRVbnByb2Nlc3NlZFByb2R1Y3RzKGxpbWl0Q291bnQgPSAxMDApIHtcbiAgICBjb25zb2xlLmxvZyhg8J+UjSBGZXRjaGluZyB1bnByb2Nlc3NlZCBwcm9kdWN0cyB3aXRoIGxpbWl0OiAke2xpbWl0Q291bnR9YCk7XG4gICAgY29uc29sZS5sb2coYPCflI0gTGltaXQgdHlwZTogJHt0eXBlb2YgbGltaXRDb3VudH0sIHZhbHVlOiAke2xpbWl0Q291bnR9YCk7XG4gICAgXG4gICAgLy8gRmlyc3QgZ2V0IGEgY291bnQgb2YgYWxsIHByb2R1Y3RzIGFuZCBwcm9jZXNzZWQgcHJvZHVjdHMgZm9yIGRlYnVnZ2luZ1xuICAgIGNvbnN0IGFsbFByb2R1Y3RzUSA9IHF1ZXJ5KGNvbGxlY3Rpb24oZGIsICdwcm9kdWN0cycpKTtcbiAgICBjb25zdCBhbGxTbmFwc2hvdCA9IGF3YWl0IGdldERvY3MoYWxsUHJvZHVjdHNRKTtcbiAgICBjb25zdCB0b3RhbFByb2R1Y3RzID0gYWxsU25hcHNob3Quc2l6ZTtcbiAgICBcbiAgICBjb25zdCBwcm9jZXNzZWRRID0gcXVlcnkoXG4gICAgICBjb2xsZWN0aW9uKGRiLCAncHJvZHVjdHMnKSxcbiAgICAgIHdoZXJlKCdjYXRlZ29yeVByb2Nlc3NlZCcsICc9PScsIHRydWUpXG4gICAgKTtcbiAgICBjb25zdCBwcm9jZXNzZWRTbmFwc2hvdCA9IGF3YWl0IGdldERvY3MocHJvY2Vzc2VkUSk7XG4gICAgY29uc3QgcHJvY2Vzc2VkQ291bnQgPSBwcm9jZXNzZWRTbmFwc2hvdC5zaXplO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKGDwn5OKIERhdGFiYXNlIHN0YXRzOiAke3RvdGFsUHJvZHVjdHN9IHRvdGFsIHByb2R1Y3RzLCAke3Byb2Nlc3NlZENvdW50fSBwcm9jZXNzZWQsICR7dG90YWxQcm9kdWN0cyAtIHByb2Nlc3NlZENvdW50fSB1bnByb2Nlc3NlZGApO1xuICAgIFxuICAgIC8vIExldCdzIGNoZWNrIHdoYXQgcHJvZHVjdHMgaGF2ZSBmb3IgY2F0ZWdvcnlQcm9jZXNzZWQgZmllbGRcbiAgICBjb25zb2xlLmxvZyhg8J+UjSBDaGVja2luZyBjYXRlZ29yeVByb2Nlc3NlZCBmaWVsZCB2YWx1ZXMuLi5gKTtcbiAgICBsZXQgZmFsc2VDb3VudCA9IDA7XG4gICAgbGV0IHRydWVDb3VudCA9IDA7XG4gICAgbGV0IHVuZGVmaW5lZENvdW50ID0gMDtcbiAgICBsZXQgbnVsbENvdW50ID0gMDtcbiAgICBcbiAgICBhbGxTbmFwc2hvdC5kb2NzLmZvckVhY2goZG9jID0+IHtcbiAgICAgIGNvbnN0IGRhdGEgPSBkb2MuZGF0YSgpO1xuICAgICAgaWYgKGRhdGEuY2F0ZWdvcnlQcm9jZXNzZWQgPT09IGZhbHNlKSBmYWxzZUNvdW50Kys7XG4gICAgICBlbHNlIGlmIChkYXRhLmNhdGVnb3J5UHJvY2Vzc2VkID09PSB0cnVlKSB0cnVlQ291bnQrKztcbiAgICAgIGVsc2UgaWYgKGRhdGEuY2F0ZWdvcnlQcm9jZXNzZWQgPT09IHVuZGVmaW5lZCkgdW5kZWZpbmVkQ291bnQrKztcbiAgICAgIGVsc2UgaWYgKGRhdGEuY2F0ZWdvcnlQcm9jZXNzZWQgPT09IG51bGwpIG51bGxDb3VudCsrO1xuICAgIH0pO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKGDwn5OKIENhdGVnb3J5UHJvY2Vzc2VkIHZhbHVlczogZmFsc2U9JHtmYWxzZUNvdW50fSwgdHJ1ZT0ke3RydWVDb3VudH0sIHVuZGVmaW5lZD0ke3VuZGVmaW5lZENvdW50fSwgbnVsbD0ke251bGxDb3VudH1gKTtcbiAgICBcbiAgICAvLyBQYXJzZSBsaW1pdCB0byBlbnN1cmUgaXQncyBhIG51bWJlclxuICAgIGNvbnN0IG51bWVyaWNMaW1pdCA9IHBhcnNlSW50KGxpbWl0Q291bnQpIHx8IDEwMDtcbiAgICBjb25zb2xlLmxvZyhg8J+UjSBVc2luZyBudW1lcmljIGxpbWl0OiAke251bWVyaWNMaW1pdH1gKTtcbiAgICBcbiAgICBjb25zdCBxID0gcXVlcnkoXG4gICAgICBjb2xsZWN0aW9uKGRiLCAncHJvZHVjdHMnKSxcbiAgICAgIHdoZXJlKCdjYXRlZ29yeVByb2Nlc3NlZCcsICc9PScsIGZhbHNlKSxcbiAgICAgIGZiTGltaXQobnVtZXJpY0xpbWl0KVxuICAgICk7XG4gICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCBnZXREb2NzKHEpO1xuICAgIFxuICAgIGNvbnN0IHByb2R1Y3RzID0gc25hcHNob3QuZG9jcy5tYXAoZG9jID0+ICh7XG4gICAgICBpZDogZG9jLmlkLFxuICAgICAgLi4uZG9jLmRhdGEoKVxuICAgIH0pKTtcbiAgICBcbiAgICBjb25zb2xlLmxvZyhg8J+TpiBGb3VuZCAke3Byb2R1Y3RzLmxlbmd0aH0gdW5wcm9jZXNzZWQgcHJvZHVjdHMgdG8gcHJvY2VzcyAocmVxdWVzdGVkIGxpbWl0OiAke2xpbWl0Q291bnR9LCBudW1lcmljIGxpbWl0OiAke251bWVyaWNMaW1pdH0pYCk7XG4gICAgXG4gICAgLy8gU2hvdyBmaXJzdCBmZXcgcHJvZHVjdHMgZm9yIGRlYnVnZ2luZ1xuICAgIGlmIChwcm9kdWN0cy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zb2xlLmxvZyhg8J+UjSBGaXJzdCBmZXcgdW5wcm9jZXNzZWQgcHJvZHVjdHM6YCk7XG4gICAgICBwcm9kdWN0cy5zbGljZSgwLCAzKS5mb3JFYWNoKChwcm9kdWN0LCBpbmRleCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhgICAke2luZGV4ICsgMX0uIFwiJHtwcm9kdWN0LnRpdGxlfVwiIC0gY2F0ZWdvcnlQcm9jZXNzZWQ6ICR7cHJvZHVjdC5jYXRlZ29yeVByb2Nlc3NlZH1gKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gcHJvZHVjdHM7XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgdXBkYXRlQ2F0ZWdvcnkocHJvZHVjdElkLCBjYXRlZ29yeURhdGEpIHtcbiAgICBjb25zdCBkb2NSZWYgPSBkb2MoZGIsICdwcm9kdWN0cycsIHByb2R1Y3RJZCk7XG4gICAgYXdhaXQgdXBkYXRlRG9jKGRvY1JlZiwge1xuICAgICAgZW1hZ0NhdGVnb3J5OiBjYXRlZ29yeURhdGEudGl0bGUsXG4gICAgICBlbWFnQ2F0ZWdvcnlJZDogY2F0ZWdvcnlEYXRhLmlkLFxuICAgICAgZW1hZ0NhdGVnb3J5UGF0aDogY2F0ZWdvcnlEYXRhLnBhdGgsXG4gICAgICBjYXRlZ29yeVByb2Nlc3NlZDogdHJ1ZSxcbiAgICAgIGNhdGVnb3J5VXBkYXRlZEF0OiBuZXcgRGF0ZSgpXG4gICAgfSk7XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgZ2V0Rm9yRmVlZEFQSShmaWx0ZXJzID0ge30pIHtcbiAgICBsZXQgcSA9IGNvbGxlY3Rpb24oZGIsICdwcm9kdWN0cycpO1xuICAgIGNvbnN0IGNvbmRpdGlvbnMgPSBbXTtcbiAgICBcbiAgICBpZiAoZmlsdGVycy5mZWVkSWQpIHtcbiAgICAgIGNvbmRpdGlvbnMucHVzaCh3aGVyZSgnZmVlZElkJywgJz09JywgZmlsdGVycy5mZWVkSWQpKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKGZpbHRlcnMuYnJhbmQpIHtcbiAgICAgIGNvbmRpdGlvbnMucHVzaCh3aGVyZSgnYnJhbmQnLCAnPT0nLCBmaWx0ZXJzLmJyYW5kKSk7XG4gICAgfVxuICAgIFxuICAgIGlmIChmaWx0ZXJzLmxpbWl0KSB7XG4gICAgICBjb25kaXRpb25zLnB1c2goZmJMaW1pdChmaWx0ZXJzLmxpbWl0KSk7XG4gICAgfVxuICAgIFxuICAgIGlmIChjb25kaXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgIHEgPSBxdWVyeShxLCAuLi5jb25kaXRpb25zKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCBnZXREb2NzKHEpO1xuICAgIHJldHVybiBzbmFwc2hvdC5kb2NzLm1hcChkb2MgPT4gKHtcbiAgICAgIGlkOiBkb2MuaWQsXG4gICAgICAuLi5kb2MuZGF0YSgpXG4gICAgfSkpO1xuICB9XG5cbiAgc3RhdGljIGFzeW5jIGdldEZvckRhc2hib2FyZChmaWx0ZXJzID0ge30pIHtcbiAgICBsZXQgcSA9IGNvbGxlY3Rpb24oZGIsICdwcm9kdWN0cycpO1xuICAgIGNvbnN0IGNvbmRpdGlvbnMgPSBbXTtcbiAgICBcbiAgICAvLyBGaWx0ZXIgYnkgdXNlcidzIGZlZWRzXG4gICAgaWYgKGZpbHRlcnMuZmVlZElkcyAmJiBmaWx0ZXJzLmZlZWRJZHMubGVuZ3RoID4gMCkge1xuICAgICAgY29uZGl0aW9ucy5wdXNoKHdoZXJlKCdmZWVkSWQnLCAnaW4nLCBmaWx0ZXJzLmZlZWRJZHMuc2xpY2UoMCwgMTApKSk7IC8vIEZpcmVzdG9yZSBsaW1pdFxuICAgIH1cbiAgICBcbiAgICAvLyBGaWx0ZXIgYnkgc3BlY2lmaWMgZmVlZFxuICAgIGlmIChmaWx0ZXJzLmZlZWRJZCkge1xuICAgICAgY29uZGl0aW9ucy5wdXNoKHdoZXJlKCdmZWVkSWQnLCAnPT0nLCBmaWx0ZXJzLmZlZWRJZCkpO1xuICAgIH1cbiAgICBcbiAgICAvLyBGaWx0ZXIgYnkgYnJhbmRcbiAgICBpZiAoZmlsdGVycy5icmFuZCkge1xuICAgICAgY29uZGl0aW9ucy5wdXNoKHdoZXJlKCdicmFuZCcsICc9PScsIGZpbHRlcnMuYnJhbmQpKTtcbiAgICB9XG4gICAgXG4gICAgLy8gRmlsdGVyIGJ5IGNhdGVnb3J5IHByb2Nlc3Npbmcgc3RhdHVzXG4gICAgaWYgKGZpbHRlcnMuY2F0ZWdvcnlQcm9jZXNzZWQgIT09IG51bGwpIHtcbiAgICAgIGNvbmRpdGlvbnMucHVzaCh3aGVyZSgnY2F0ZWdvcnlQcm9jZXNzZWQnLCAnPT0nLCBmaWx0ZXJzLmNhdGVnb3J5UHJvY2Vzc2VkKSk7XG4gICAgfVxuICAgIFxuICAgIC8vIEFkZCBvcmRlcmluZyBhbmQgbGltaXRcbiAgICBjb25kaXRpb25zLnB1c2gob3JkZXJCeSgnbGFzdFVwZGF0ZWQnLCAnZGVzYycpKTtcbiAgICBjb25kaXRpb25zLnB1c2goZmJMaW1pdChmaWx0ZXJzLmxpbWl0IHx8IDUwKSk7XG4gICAgXG4gICAgaWYgKGNvbmRpdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgcSA9IHF1ZXJ5KHEsIC4uLmNvbmRpdGlvbnMpO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBzbmFwc2hvdCA9IGF3YWl0IGdldERvY3MocSk7XG4gICAgbGV0IHByb2R1Y3RzID0gc25hcHNob3QuZG9jcy5tYXAoZG9jID0+ICh7XG4gICAgICBpZDogZG9jLmlkLFxuICAgICAgLi4uZG9jLmRhdGEoKVxuICAgIH0pKTtcbiAgICBcbiAgICAvLyBDbGllbnQtc2lkZSBmaWx0ZXJpbmcgZm9yIHNlYXJjaCB0ZXJtcyAoc2luY2UgRmlyZXN0b3JlIGRvZXNuJ3Qgc3VwcG9ydCBmdWxsLXRleHQgc2VhcmNoKVxuICAgIGlmIChmaWx0ZXJzLnNlYXJjaCkge1xuICAgICAgY29uc3Qgc2VhcmNoTG93ZXIgPSBmaWx0ZXJzLnNlYXJjaC50b0xvd2VyQ2FzZSgpO1xuICAgICAgcHJvZHVjdHMgPSBwcm9kdWN0cy5maWx0ZXIocHJvZHVjdCA9PiBcbiAgICAgICAgKHByb2R1Y3QudGl0bGUgfHwgJycpLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoTG93ZXIpIHx8XG4gICAgICAgIChwcm9kdWN0LmRlc2NyaXB0aW9uIHx8ICcnKS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHNlYXJjaExvd2VyKSB8fFxuICAgICAgICAocHJvZHVjdC5icmFuZCB8fCAnJykudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2hMb3dlcikgfHxcbiAgICAgICAgKHByb2R1Y3Qub3JpZ2luYWxDYXRlZ29yaWVzIHx8IFtdKS5zb21lKGNhdCA9PiBcbiAgICAgICAgICBjYXQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2hMb3dlcilcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHByb2R1Y3RzLFxuICAgICAgdG90YWw6IHByb2R1Y3RzLmxlbmd0aFxuICAgIH07XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgZ2V0QnJhbmRzQnlVc2VyKGZlZWRJZHMpIHtcbiAgICBpZiAoIWZlZWRJZHMgfHwgZmVlZElkcy5sZW5ndGggPT09IDApIHJldHVybiBbXTtcbiAgICBcbiAgICBjb25zdCBxID0gcXVlcnkoXG4gICAgICBjb2xsZWN0aW9uKGRiLCAncHJvZHVjdHMnKSxcbiAgICAgIHdoZXJlKCdmZWVkSWQnLCAnaW4nLCBmZWVkSWRzLnNsaWNlKDAsIDEwKSlcbiAgICApO1xuICAgIFxuICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhxKTtcbiAgICBjb25zdCBicmFuZHMgPSBuZXcgU2V0KCk7XG4gICAgXG4gICAgc25hcHNob3QuZG9jcy5mb3JFYWNoKGRvYyA9PiB7XG4gICAgICBjb25zdCBwcm9kdWN0ID0gZG9jLmRhdGEoKTtcbiAgICAgIGlmIChwcm9kdWN0LmJyYW5kICYmIHByb2R1Y3QuYnJhbmQudHJpbSgpKSB7XG4gICAgICAgIGJyYW5kcy5hZGQocHJvZHVjdC5icmFuZC50cmltKCkpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIHJldHVybiBBcnJheS5mcm9tKGJyYW5kcykuc29ydCgpO1xuICB9XG5cbiAgc3RhdGljIGFzeW5jIGdldFByb2Nlc3NpbmdTdGF0cyhmZWVkSWRzKSB7XG4gICAgaWYgKCFmZWVkSWRzIHx8IGZlZWRJZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4geyBwcm9jZXNzZWQ6IDAsIHVucHJvY2Vzc2VkOiAwLCB0b3RhbDogMCB9O1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBxID0gcXVlcnkoXG4gICAgICBjb2xsZWN0aW9uKGRiLCAncHJvZHVjdHMnKSxcbiAgICAgIHdoZXJlKCdmZWVkSWQnLCAnaW4nLCBmZWVkSWRzLnNsaWNlKDAsIDEwKSlcbiAgICApO1xuICAgIFxuICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhxKTtcbiAgICBsZXQgcHJvY2Vzc2VkID0gMDtcbiAgICBsZXQgdW5wcm9jZXNzZWQgPSAwO1xuICAgIFxuICAgIHNuYXBzaG90LmRvY3MuZm9yRWFjaChkb2MgPT4ge1xuICAgICAgY29uc3QgcHJvZHVjdCA9IGRvYy5kYXRhKCk7XG4gICAgICBpZiAocHJvZHVjdC5jYXRlZ29yeVByb2Nlc3NlZCA9PT0gdHJ1ZSkge1xuICAgICAgICBwcm9jZXNzZWQrKztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHVucHJvY2Vzc2VkKys7XG4gICAgICB9XG4gICAgfSk7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHByb2Nlc3NlZCxcbiAgICAgIHVucHJvY2Vzc2VkLFxuICAgICAgdG90YWw6IHByb2Nlc3NlZCArIHVucHJvY2Vzc2VkXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgU3luY0pvYk1vZGVsIHtcbiAgc3RhdGljIGFzeW5jIGNyZWF0ZShmZWVkSWQsIHR5cGUgPSAnc2NoZWR1bGVkJykge1xuICAgIGNvbnN0IGRvY1JlZiA9IGF3YWl0IGFkZERvYyhjb2xsZWN0aW9uKGRiLCAnc3luY19qb2JzJyksIHtcbiAgICAgIGZlZWRJZCxcbiAgICAgIHR5cGUsXG4gICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIHN0YXJ0ZWRBdDogbnVsbCxcbiAgICAgIGNvbXBsZXRlZEF0OiBudWxsLFxuICAgICAgZXJyb3I6IG51bGwsXG4gICAgICBpdGVtc1Byb2Nlc3NlZDogMCxcbiAgICAgIGl0ZW1zVG90YWw6IDBcbiAgICB9KTtcbiAgICByZXR1cm4gZG9jUmVmLmlkO1xuICB9XG5cbiAgc3RhdGljIGFzeW5jIHVwZGF0ZVN0YXR1cyhqb2JJZCwgc3RhdHVzLCB1cGRhdGVzID0ge30pIHtcbiAgICBjb25zdCB1cGRhdGVEYXRhID0ge1xuICAgICAgc3RhdHVzLFxuICAgICAgLi4udXBkYXRlc1xuICAgIH07XG4gICAgXG4gICAgaWYgKHN0YXR1cyA9PT0gJ3J1bm5pbmcnKSB7XG4gICAgICB1cGRhdGVEYXRhLnN0YXJ0ZWRBdCA9IG5ldyBEYXRlKCk7XG4gICAgfSBlbHNlIGlmIChzdGF0dXMgPT09ICdjb21wbGV0ZWQnIHx8IHN0YXR1cyA9PT0gJ2ZhaWxlZCcpIHtcbiAgICAgIHVwZGF0ZURhdGEuY29tcGxldGVkQXQgPSBuZXcgRGF0ZSgpO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBkb2NSZWYgPSBkb2MoZGIsICdzeW5jX2pvYnMnLCBqb2JJZCk7XG4gICAgYXdhaXQgdXBkYXRlRG9jKGRvY1JlZiwgdXBkYXRlRGF0YSk7XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgZ2V0QWN0aXZlKCkge1xuICAgIGNvbnN0IHEgPSBxdWVyeShcbiAgICAgIGNvbGxlY3Rpb24oZGIsICdzeW5jX2pvYnMnKSxcbiAgICAgIHdoZXJlKCdzdGF0dXMnLCAnaW4nLCBbJ3BlbmRpbmcnLCAncnVubmluZyddKSxcbiAgICAgIG9yZGVyQnkoJ2NyZWF0ZWRBdCcsICdhc2MnKVxuICAgICk7XG4gICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCBnZXREb2NzKHEpO1xuICAgIFxuICAgIHJldHVybiBzbmFwc2hvdC5kb2NzLm1hcChkb2MgPT4gKHtcbiAgICAgIGlkOiBkb2MuaWQsXG4gICAgICAuLi5kb2MuZGF0YSgpXG4gICAgfSkpO1xuICB9XG5cbiAgc3RhdGljIGFzeW5jIGdldEJ5RmVlZChmZWVkSWQsIGxpbWl0Q291bnQgPSAyMCkge1xuICAgIGNvbnN0IHEgPSBxdWVyeShcbiAgICAgIGNvbGxlY3Rpb24oZGIsICdzeW5jX2pvYnMnKSxcbiAgICAgIHdoZXJlKCdmZWVkSWQnLCAnPT0nLCBmZWVkSWQpLFxuICAgICAgb3JkZXJCeSgnY3JlYXRlZEF0JywgJ2Rlc2MnKSxcbiAgICAgIGZiTGltaXQobGltaXRDb3VudClcbiAgICApO1xuICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhxKTtcbiAgICBcbiAgICByZXR1cm4gc25hcHNob3QuZG9jcy5tYXAoZG9jID0+ICh7XG4gICAgICBpZDogZG9jLmlkLFxuICAgICAgLi4uZG9jLmRhdGEoKVxuICAgIH0pKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgV2ViaG9va01vZGVsIHtcbiAgc3RhdGljIGFzeW5jIGNyZWF0ZSh1c2VySWQsIHdlYmhvb2tEYXRhKSB7XG4gICAgY29uc3QgZG9jUmVmID0gYXdhaXQgYWRkRG9jKGNvbGxlY3Rpb24oZGIsICd3ZWJob29rcycpLCB7XG4gICAgICAuLi53ZWJob29rRGF0YSxcbiAgICAgIHVzZXJJZCxcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgbGFzdFRyaWdnZXJlZDogbnVsbFxuICAgIH0pO1xuICAgIHJldHVybiBkb2NSZWYuaWQ7XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgZ2V0QnlVc2VyKHVzZXJJZCkge1xuICAgIGNvbnN0IHEgPSBxdWVyeShcbiAgICAgIGNvbGxlY3Rpb24oZGIsICd3ZWJob29rcycpLFxuICAgICAgd2hlcmUoJ3VzZXJJZCcsICc9PScsIHVzZXJJZCksXG4gICAgICB3aGVyZSgnaXNBY3RpdmUnLCAnPT0nLCB0cnVlKVxuICAgICk7XG4gICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCBnZXREb2NzKHEpO1xuICAgIFxuICAgIHJldHVybiBzbmFwc2hvdC5kb2NzLm1hcChkb2MgPT4gKHtcbiAgICAgIGlkOiBkb2MuaWQsXG4gICAgICAuLi5kb2MuZGF0YSgpXG4gICAgfSkpO1xuICB9XG5cbiAgc3RhdGljIGFzeW5jIHRyaWdnZXIod2ViaG9va0lkLCBkYXRhKSB7XG4gICAgY29uc3QgZG9jUmVmID0gZG9jKGRiLCAnd2ViaG9va3MnLCB3ZWJob29rSWQpO1xuICAgIGF3YWl0IHVwZGF0ZURvYyhkb2NSZWYsIHtcbiAgICAgIGxhc3RUcmlnZ2VyZWQ6IG5ldyBEYXRlKCksXG4gICAgICBsYXN0VHJpZ2dlckRhdGE6IGRhdGFcbiAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyBhc3luYyBnZXRCeUlkKHdlYmhvb2tJZCkge1xuICAgIGNvbnN0IGRvY1JlZiA9IGRvYyhkYiwgJ3dlYmhvb2tzJywgd2ViaG9va0lkKTtcbiAgICBjb25zdCBkb2NTbmFwID0gYXdhaXQgZ2V0RG9jKGRvY1JlZik7XG4gICAgcmV0dXJuIGRvY1NuYXAuZXhpc3RzKCkgPyB7IGlkOiBkb2NTbmFwLmlkLCAuLi5kb2NTbmFwLmRhdGEoKSB9IDogbnVsbDtcbiAgfVxuXG4gIHN0YXRpYyBhc3luYyB1cGRhdGUod2ViaG9va0lkLCB1cGRhdGVzKSB7XG4gICAgY29uc3QgZG9jUmVmID0gZG9jKGRiLCAnd2ViaG9va3MnLCB3ZWJob29rSWQpO1xuICAgIGF3YWl0IHVwZGF0ZURvYyhkb2NSZWYsIHtcbiAgICAgIC4uLnVwZGF0ZXMsXG4gICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKClcbiAgICB9KTtcbiAgfVxufSJdLCJuYW1lcyI6WyJkYiIsImNvbGxlY3Rpb24iLCJhZGREb2MiLCJkb2MiLCJnZXREb2MiLCJnZXREb2NzIiwidXBkYXRlRG9jIiwiZGVsZXRlRG9jIiwic2V0RG9jIiwicXVlcnkiLCJ3aGVyZSIsIm9yZGVyQnkiLCJsaW1pdCIsImZiTGltaXQiLCJzdGFydEFmdGVyIiwiRmVlZE1vZGVsIiwiY3JlYXRlIiwidXNlcklkIiwiZmVlZERhdGEiLCJkb2NSZWYiLCJjcmVhdGVkQXQiLCJEYXRlIiwidXBkYXRlZEF0Iiwic3RhdHVzIiwibGFzdFN5bmNBdCIsInN5bmNJbnRlcnZhbCIsImlzUGF1c2VkIiwiaWQiLCJnZXRCeVVzZXIiLCJxIiwic25hcHNob3QiLCJkb2NzIiwibWFwIiwiZGF0YSIsImdldEJ5SWQiLCJmZWVkSWQiLCJkb2NTbmFwIiwiZXhpc3RzIiwidXBkYXRlIiwidXBkYXRlcyIsImRlbGV0ZSIsIlByb2R1Y3RNb2RlbCIsImNyZWF0ZU9yVXBkYXRlIiwicHJvZHVjdERhdGEiLCJwcm9kdWN0SWQiLCJza3UiLCJleGlzdGluZ0RvYyIsImV4aXN0aW5nRGF0YSIsInByb2R1Y3REb2MiLCJsYXN0VXBkYXRlZCIsImNhdGVnb3J5UHJvY2Vzc2VkIiwiZW1hZ0NhdGVnb3J5IiwiZW1hZ0NhdGVnb3J5SWQiLCJlbWFnQ2F0ZWdvcnlQYXRoIiwiY2F0ZWdvcnlVcGRhdGVkQXQiLCJjb25zb2xlIiwibG9nIiwidGl0bGUiLCJtZXJnZSIsImdldEJ5RmVlZCIsImxpbWl0Q291bnQiLCJvZmZzZXQiLCJnZXRVbnByb2Nlc3NlZFByb2R1Y3RzIiwiYWxsUHJvZHVjdHNRIiwiYWxsU25hcHNob3QiLCJ0b3RhbFByb2R1Y3RzIiwic2l6ZSIsInByb2Nlc3NlZFEiLCJwcm9jZXNzZWRTbmFwc2hvdCIsInByb2Nlc3NlZENvdW50IiwiZmFsc2VDb3VudCIsInRydWVDb3VudCIsInVuZGVmaW5lZENvdW50IiwibnVsbENvdW50IiwiZm9yRWFjaCIsInVuZGVmaW5lZCIsIm51bWVyaWNMaW1pdCIsInBhcnNlSW50IiwicHJvZHVjdHMiLCJsZW5ndGgiLCJzbGljZSIsInByb2R1Y3QiLCJpbmRleCIsInVwZGF0ZUNhdGVnb3J5IiwiY2F0ZWdvcnlEYXRhIiwicGF0aCIsImdldEZvckZlZWRBUEkiLCJmaWx0ZXJzIiwiY29uZGl0aW9ucyIsInB1c2giLCJicmFuZCIsImdldEZvckRhc2hib2FyZCIsImZlZWRJZHMiLCJzZWFyY2giLCJzZWFyY2hMb3dlciIsInRvTG93ZXJDYXNlIiwiZmlsdGVyIiwiaW5jbHVkZXMiLCJkZXNjcmlwdGlvbiIsIm9yaWdpbmFsQ2F0ZWdvcmllcyIsInNvbWUiLCJjYXQiLCJ0b3RhbCIsImdldEJyYW5kc0J5VXNlciIsImJyYW5kcyIsIlNldCIsInRyaW0iLCJhZGQiLCJBcnJheSIsImZyb20iLCJzb3J0IiwiZ2V0UHJvY2Vzc2luZ1N0YXRzIiwicHJvY2Vzc2VkIiwidW5wcm9jZXNzZWQiLCJTeW5jSm9iTW9kZWwiLCJ0eXBlIiwic3RhcnRlZEF0IiwiY29tcGxldGVkQXQiLCJlcnJvciIsIml0ZW1zUHJvY2Vzc2VkIiwiaXRlbXNUb3RhbCIsInVwZGF0ZVN0YXR1cyIsImpvYklkIiwidXBkYXRlRGF0YSIsImdldEFjdGl2ZSIsIldlYmhvb2tNb2RlbCIsIndlYmhvb2tEYXRhIiwiaXNBY3RpdmUiLCJsYXN0VHJpZ2dlcmVkIiwidHJpZ2dlciIsIndlYmhvb2tJZCIsImxhc3RUcmlnZ2VyRGF0YSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/models.js\n");

/***/ }),

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdashboard%2Fproducts&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fdashboard%2Fproducts.js&middlewareConfigBase64=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdashboard%2Fproducts&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fdashboard%2Fproducts.js&middlewareConfigBase64=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_dashboard_products_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/dashboard/products.js */ \"(api-node)/./pages/api/dashboard/products.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_dashboard_products_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_dashboard_products_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_dashboard_products_js__WEBPACK_IMPORTED_MODULE_3__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_dashboard_products_js__WEBPACK_IMPORTED_MODULE_3__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/dashboard/products\",\n        pathname: \"/api/dashboard/products\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_dashboard_products_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGZGFzaGJvYXJkJTJGcHJvZHVjdHMmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyUyRmFwaSUyRmRhc2hib2FyZCUyRnByb2R1Y3RzLmpzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUErRjtBQUN2QztBQUNFO0FBQzFEO0FBQzhEO0FBQzlEO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQyw2REFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsNkRBQVE7QUFDcEM7QUFDTyx3QkFBd0IseUdBQW1CO0FBQ2xEO0FBQ0EsY0FBYyxrRUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVELHFDIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlcy9hcGkvZGFzaGJvYXJkL3Byb2R1Y3RzLmpzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsICdkZWZhdWx0Jyk7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCAnY29uZmlnJyk7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9kYXNoYm9hcmQvcHJvZHVjdHNcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9kYXNoYm9hcmQvcHJvZHVjdHNcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiAnJyxcbiAgICAgICAgZmlsZW5hbWU6ICcnXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdashboard%2Fproducts&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fdashboard%2Fproducts.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./pages/api/dashboard/products.js":
/*!*****************************************!*\
  !*** ./pages/api/dashboard/products.js ***!
  \*****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_models_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/models.js */ \"(api-node)/./lib/models.js\");\n/* harmony import */ var _lib_firebase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/firebase.js */ \"(api-node)/./lib/firebase.js\");\n/* harmony import */ var firebase_firestore__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! firebase/firestore */ \"firebase/firestore\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_models_js__WEBPACK_IMPORTED_MODULE_0__, _lib_firebase_js__WEBPACK_IMPORTED_MODULE_1__, firebase_firestore__WEBPACK_IMPORTED_MODULE_2__]);\n([_lib_models_js__WEBPACK_IMPORTED_MODULE_0__, _lib_firebase_js__WEBPACK_IMPORTED_MODULE_1__, firebase_firestore__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\nasync function handler(req, res) {\n    if (req.method !== 'GET') {\n        res.setHeader('Allow', [\n            'GET'\n        ]);\n        return res.status(405).json({\n            error: 'Method not allowed'\n        });\n    }\n    try {\n        // Get the user ID from the session/token\n        const { userId } = req.query;\n        if (!userId) {\n            return res.status(401).json({\n                error: 'User ID required'\n            });\n        }\n        const { search = '', brand = '', feedId = '', categoryProcessed = '', limit = 50, offset = 0 } = req.query;\n        // Get user's feeds to filter products\n        const userFeeds = await _lib_models_js__WEBPACK_IMPORTED_MODULE_0__.FeedModel.getByUser(userId);\n        const feedIds = userFeeds.map((feed)=>feed.id);\n        if (feedIds.length === 0) {\n            return res.json({\n                products: [],\n                total: 0,\n                brands: [],\n                feeds: [],\n                processingStats: {\n                    processed: 0,\n                    unprocessed: 0,\n                    total: 0\n                }\n            });\n        }\n        // Build filters for the dashboard\n        const filters = {\n            feedIds,\n            search: search.toLowerCase().trim(),\n            brand: brand.trim(),\n            feedId: feedId.trim(),\n            categoryProcessed: categoryProcessed === '' ? null : categoryProcessed === 'true',\n            limit: Math.min(parseInt(limit) || 50, 100),\n            offset: parseInt(offset) || 0\n        };\n        // Get products with dashboard-specific filtering\n        const result = await _lib_models_js__WEBPACK_IMPORTED_MODULE_0__.ProductModel.getForDashboard(filters);\n        // Get all unique brands for filter dropdown\n        const brands = await _lib_models_js__WEBPACK_IMPORTED_MODULE_0__.ProductModel.getBrandsByUser(feedIds);\n        // Get processing statistics\n        const processingStats = await _lib_models_js__WEBPACK_IMPORTED_MODULE_0__.ProductModel.getProcessingStats(feedIds);\n        return res.json({\n            products: result.products,\n            total: result.total,\n            brands,\n            feeds: userFeeds.map((feed)=>({\n                    id: feed.id,\n                    name: feed.name,\n                    url: feed.url\n                })),\n            processingStats,\n            filters: {\n                search: search || null,\n                brand: brand || null,\n                feedId: feedId || null,\n                categoryProcessed: categoryProcessed || null\n            }\n        });\n    } catch (error) {\n        console.error('Dashboard products API error:', error);\n        return res.status(500).json({\n            error: 'Internal server error'\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL3BhZ2VzL2FwaS9kYXNoYm9hcmQvcHJvZHVjdHMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFpRTtBQUNqQjtBQUMyRTtBQUM3RTtBQUUvQixlQUFlYyxRQUFRQyxHQUFHLEVBQUVDLEdBQUc7SUFDNUMsSUFBSUQsSUFBSUUsTUFBTSxLQUFLLE9BQU87UUFDeEJELElBQUlFLFNBQVMsQ0FBQyxTQUFTO1lBQUM7U0FBTTtRQUM5QixPQUFPRixJQUFJRyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBcUI7SUFDNUQ7SUFFQSxJQUFJO1FBQ0YseUNBQXlDO1FBQ3pDLE1BQU0sRUFBRUMsTUFBTSxFQUFFLEdBQUdQLElBQUlYLEtBQUs7UUFDNUIsSUFBSSxDQUFDa0IsUUFBUTtZQUNYLE9BQU9OLElBQUlHLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQUVDLE9BQU87WUFBbUI7UUFDMUQ7UUFFQSxNQUFNLEVBQ0pFLFNBQVMsRUFBRSxFQUNYQyxRQUFRLEVBQUUsRUFDVkMsU0FBUyxFQUFFLEVBQ1hDLG9CQUFvQixFQUFFLEVBQ3RCbkIsUUFBUSxFQUFFLEVBQ1ZvQixTQUFTLENBQUMsRUFDWCxHQUFHWixJQUFJWCxLQUFLO1FBRWIsc0NBQXNDO1FBQ3RDLE1BQU13QixZQUFZLE1BQU0zQixxREFBU0EsQ0FBQzRCLFNBQVMsQ0FBQ1A7UUFDNUMsTUFBTVEsVUFBVUYsVUFBVUcsR0FBRyxDQUFDQyxDQUFBQSxPQUFRQSxLQUFLQyxFQUFFO1FBRTdDLElBQUlILFFBQVFJLE1BQU0sS0FBSyxHQUFHO1lBQ3hCLE9BQU9sQixJQUFJSSxJQUFJLENBQUM7Z0JBQ2RlLFVBQVUsRUFBRTtnQkFDWkMsT0FBTztnQkFDUEMsUUFBUSxFQUFFO2dCQUNWQyxPQUFPLEVBQUU7Z0JBQ1RDLGlCQUFpQjtvQkFBRUMsV0FBVztvQkFBR0MsYUFBYTtvQkFBR0wsT0FBTztnQkFBRTtZQUM1RDtRQUNGO1FBRUEsa0NBQWtDO1FBQ2xDLE1BQU1NLFVBQVU7WUFDZFo7WUFDQVAsUUFBUUEsT0FBT29CLFdBQVcsR0FBR0MsSUFBSTtZQUNqQ3BCLE9BQU9BLE1BQU1vQixJQUFJO1lBQ2pCbkIsUUFBUUEsT0FBT21CLElBQUk7WUFDbkJsQixtQkFBbUJBLHNCQUFzQixLQUFLLE9BQU9BLHNCQUFzQjtZQUMzRW5CLE9BQU9zQyxLQUFLQyxHQUFHLENBQUNDLFNBQVN4QyxVQUFVLElBQUk7WUFDdkNvQixRQUFRb0IsU0FBU3BCLFdBQVc7UUFDOUI7UUFFQSxpREFBaUQ7UUFDakQsTUFBTXFCLFNBQVMsTUFBTWhELHdEQUFZQSxDQUFDaUQsZUFBZSxDQUFDUDtRQUVsRCw0Q0FBNEM7UUFDNUMsTUFBTUwsU0FBUyxNQUFNckMsd0RBQVlBLENBQUNrRCxlQUFlLENBQUNwQjtRQUVsRCw0QkFBNEI7UUFDNUIsTUFBTVMsa0JBQWtCLE1BQU12Qyx3REFBWUEsQ0FBQ21ELGtCQUFrQixDQUFDckI7UUFFOUQsT0FBT2QsSUFBSUksSUFBSSxDQUFDO1lBQ2RlLFVBQVVhLE9BQU9iLFFBQVE7WUFDekJDLE9BQU9ZLE9BQU9aLEtBQUs7WUFDbkJDO1lBQ0FDLE9BQU9WLFVBQVVHLEdBQUcsQ0FBQ0MsQ0FBQUEsT0FBUztvQkFBRUMsSUFBSUQsS0FBS0MsRUFBRTtvQkFBRW1CLE1BQU1wQixLQUFLb0IsSUFBSTtvQkFBRUMsS0FBS3JCLEtBQUtxQixHQUFHO2dCQUFDO1lBQzVFZDtZQUNBRyxTQUFTO2dCQUNQbkIsUUFBUUEsVUFBVTtnQkFDbEJDLE9BQU9BLFNBQVM7Z0JBQ2hCQyxRQUFRQSxVQUFVO2dCQUNsQkMsbUJBQW1CQSxxQkFBcUI7WUFDMUM7UUFDRjtJQUVGLEVBQUUsT0FBT0wsT0FBTztRQUNkaUMsUUFBUWpDLEtBQUssQ0FBQyxpQ0FBaUNBO1FBQy9DLE9BQU9MLElBQUlHLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUF3QjtJQUMvRDtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvY3Jpc3RpYW4vZGV2L2hvbGRvbmUvZmVlZGltcG9ydC9wYWdlcy9hcGkvZGFzaGJvYXJkL3Byb2R1Y3RzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByb2R1Y3RNb2RlbCwgRmVlZE1vZGVsIH0gZnJvbSAnLi4vLi4vLi4vbGliL21vZGVscy5qcyc7XG5pbXBvcnQgeyBhdXRoIH0gZnJvbSAnLi4vLi4vLi4vbGliL2ZpcmViYXNlLmpzJztcbmltcG9ydCB7IGNvbGxlY3Rpb24sIHF1ZXJ5LCB3aGVyZSwgb3JkZXJCeSwgbGltaXQgYXMgZmJMaW1pdCwgZ2V0RG9jcywgc3RhcnRBZnRlciwgZ2V0RG9jLCBkb2MgfSBmcm9tICdmaXJlYmFzZS9maXJlc3RvcmUnO1xuaW1wb3J0IHsgZGIgfSBmcm9tICcuLi8uLi8uLi9saWIvZmlyZWJhc2UuanMnO1xuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XG4gIGlmIChyZXEubWV0aG9kICE9PSAnR0VUJykge1xuICAgIHJlcy5zZXRIZWFkZXIoJ0FsbG93JywgWydHRVQnXSk7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgZXJyb3I6ICdNZXRob2Qgbm90IGFsbG93ZWQnIH0pO1xuICB9XG5cbiAgdHJ5IHtcbiAgICAvLyBHZXQgdGhlIHVzZXIgSUQgZnJvbSB0aGUgc2Vzc2lvbi90b2tlblxuICAgIGNvbnN0IHsgdXNlcklkIH0gPSByZXEucXVlcnk7XG4gICAgaWYgKCF1c2VySWQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnVXNlciBJRCByZXF1aXJlZCcgfSk7XG4gICAgfVxuXG4gICAgY29uc3Qge1xuICAgICAgc2VhcmNoID0gJycsXG4gICAgICBicmFuZCA9ICcnLFxuICAgICAgZmVlZElkID0gJycsXG4gICAgICBjYXRlZ29yeVByb2Nlc3NlZCA9ICcnLFxuICAgICAgbGltaXQgPSA1MCxcbiAgICAgIG9mZnNldCA9IDBcbiAgICB9ID0gcmVxLnF1ZXJ5O1xuXG4gICAgLy8gR2V0IHVzZXIncyBmZWVkcyB0byBmaWx0ZXIgcHJvZHVjdHNcbiAgICBjb25zdCB1c2VyRmVlZHMgPSBhd2FpdCBGZWVkTW9kZWwuZ2V0QnlVc2VyKHVzZXJJZCk7XG4gICAgY29uc3QgZmVlZElkcyA9IHVzZXJGZWVkcy5tYXAoZmVlZCA9PiBmZWVkLmlkKTtcblxuICAgIGlmIChmZWVkSWRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHJlcy5qc29uKHtcbiAgICAgICAgcHJvZHVjdHM6IFtdLFxuICAgICAgICB0b3RhbDogMCxcbiAgICAgICAgYnJhbmRzOiBbXSxcbiAgICAgICAgZmVlZHM6IFtdLFxuICAgICAgICBwcm9jZXNzaW5nU3RhdHM6IHsgcHJvY2Vzc2VkOiAwLCB1bnByb2Nlc3NlZDogMCwgdG90YWw6IDAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQnVpbGQgZmlsdGVycyBmb3IgdGhlIGRhc2hib2FyZFxuICAgIGNvbnN0IGZpbHRlcnMgPSB7XG4gICAgICBmZWVkSWRzLFxuICAgICAgc2VhcmNoOiBzZWFyY2gudG9Mb3dlckNhc2UoKS50cmltKCksXG4gICAgICBicmFuZDogYnJhbmQudHJpbSgpLFxuICAgICAgZmVlZElkOiBmZWVkSWQudHJpbSgpLFxuICAgICAgY2F0ZWdvcnlQcm9jZXNzZWQ6IGNhdGVnb3J5UHJvY2Vzc2VkID09PSAnJyA/IG51bGwgOiBjYXRlZ29yeVByb2Nlc3NlZCA9PT0gJ3RydWUnLFxuICAgICAgbGltaXQ6IE1hdGgubWluKHBhcnNlSW50KGxpbWl0KSB8fCA1MCwgMTAwKSwgLy8gTWF4IDEwMCBwcm9kdWN0cyBwZXIgcmVxdWVzdFxuICAgICAgb2Zmc2V0OiBwYXJzZUludChvZmZzZXQpIHx8IDBcbiAgICB9O1xuXG4gICAgLy8gR2V0IHByb2R1Y3RzIHdpdGggZGFzaGJvYXJkLXNwZWNpZmljIGZpbHRlcmluZ1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFByb2R1Y3RNb2RlbC5nZXRGb3JEYXNoYm9hcmQoZmlsdGVycyk7XG4gICAgXG4gICAgLy8gR2V0IGFsbCB1bmlxdWUgYnJhbmRzIGZvciBmaWx0ZXIgZHJvcGRvd25cbiAgICBjb25zdCBicmFuZHMgPSBhd2FpdCBQcm9kdWN0TW9kZWwuZ2V0QnJhbmRzQnlVc2VyKGZlZWRJZHMpO1xuICAgIFxuICAgIC8vIEdldCBwcm9jZXNzaW5nIHN0YXRpc3RpY3NcbiAgICBjb25zdCBwcm9jZXNzaW5nU3RhdHMgPSBhd2FpdCBQcm9kdWN0TW9kZWwuZ2V0UHJvY2Vzc2luZ1N0YXRzKGZlZWRJZHMpO1xuXG4gICAgcmV0dXJuIHJlcy5qc29uKHtcbiAgICAgIHByb2R1Y3RzOiByZXN1bHQucHJvZHVjdHMsXG4gICAgICB0b3RhbDogcmVzdWx0LnRvdGFsLFxuICAgICAgYnJhbmRzLFxuICAgICAgZmVlZHM6IHVzZXJGZWVkcy5tYXAoZmVlZCA9PiAoeyBpZDogZmVlZC5pZCwgbmFtZTogZmVlZC5uYW1lLCB1cmw6IGZlZWQudXJsIH0pKSxcbiAgICAgIHByb2Nlc3NpbmdTdGF0cyxcbiAgICAgIGZpbHRlcnM6IHtcbiAgICAgICAgc2VhcmNoOiBzZWFyY2ggfHwgbnVsbCxcbiAgICAgICAgYnJhbmQ6IGJyYW5kIHx8IG51bGwsXG4gICAgICAgIGZlZWRJZDogZmVlZElkIHx8IG51bGwsXG4gICAgICAgIGNhdGVnb3J5UHJvY2Vzc2VkOiBjYXRlZ29yeVByb2Nlc3NlZCB8fCBudWxsXG4gICAgICB9XG4gICAgfSk7XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdEYXNoYm9hcmQgcHJvZHVjdHMgQVBJIGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicgfSk7XG4gIH1cbn0iXSwibmFtZXMiOlsiUHJvZHVjdE1vZGVsIiwiRmVlZE1vZGVsIiwiYXV0aCIsImNvbGxlY3Rpb24iLCJxdWVyeSIsIndoZXJlIiwib3JkZXJCeSIsImxpbWl0IiwiZmJMaW1pdCIsImdldERvY3MiLCJzdGFydEFmdGVyIiwiZ2V0RG9jIiwiZG9jIiwiZGIiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwibWV0aG9kIiwic2V0SGVhZGVyIiwic3RhdHVzIiwianNvbiIsImVycm9yIiwidXNlcklkIiwic2VhcmNoIiwiYnJhbmQiLCJmZWVkSWQiLCJjYXRlZ29yeVByb2Nlc3NlZCIsIm9mZnNldCIsInVzZXJGZWVkcyIsImdldEJ5VXNlciIsImZlZWRJZHMiLCJtYXAiLCJmZWVkIiwiaWQiLCJsZW5ndGgiLCJwcm9kdWN0cyIsInRvdGFsIiwiYnJhbmRzIiwiZmVlZHMiLCJwcm9jZXNzaW5nU3RhdHMiLCJwcm9jZXNzZWQiLCJ1bnByb2Nlc3NlZCIsImZpbHRlcnMiLCJ0b0xvd2VyQ2FzZSIsInRyaW0iLCJNYXRoIiwibWluIiwicGFyc2VJbnQiLCJyZXN1bHQiLCJnZXRGb3JEYXNoYm9hcmQiLCJnZXRCcmFuZHNCeVVzZXIiLCJnZXRQcm9jZXNzaW5nU3RhdHMiLCJuYW1lIiwidXJsIiwiY29uc29sZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./pages/api/dashboard/products.js\n");

/***/ }),

/***/ "firebase/app":
/*!*******************************!*\
  !*** external "firebase/app" ***!
  \*******************************/
/***/ ((module) => {

module.exports = import("firebase/app");;

/***/ }),

/***/ "firebase/auth":
/*!********************************!*\
  !*** external "firebase/auth" ***!
  \********************************/
/***/ ((module) => {

module.exports = import("firebase/auth");;

/***/ }),

/***/ "firebase/firestore":
/*!*************************************!*\
  !*** external "firebase/firestore" ***!
  \*************************************/
/***/ ((module) => {

module.exports = import("firebase/firestore");;

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdashboard%2Fproducts&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fdashboard%2Fproducts.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();